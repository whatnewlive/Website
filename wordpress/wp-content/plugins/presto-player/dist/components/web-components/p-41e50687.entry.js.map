{"version":3,"names":["prestoPlaylistCss","PrestoPlaylistStyle0","PrestoPlaylist","rewatch","this","handlePlay","next","handleNext","handleCurrentPlay","value","previousValue","addOverlay","currentPlyr","elements","container","getRootNode","host","style","currentPlaylistItem","config","styles","provider","isIOS","undefined","muted","_a","embed","unMute","play","resetPlayingStateOnItemChange","playing","overlay","document","createElement","nextItemTitle","getNextItemTitle","isLastItem","nextItemString","listTextSingular","transitionDuration","_b","closest","append","componentWillLoad","items","handleItemClick","item","show","el","height","offsetHeight","width","offsetWidth","getNextItem","handlePause","pause","nextItem","i","length","id","_c","_d","lastIndex","title","render","listTextS","listTextP","listTextPlural","h","src","Object","assign","slot","video_id","_e","_f","class","_g","playerClass","key","_h","_j","onPlayerReady","e","detail","onPlayedMedia","onPausedMedia","onEndedMedia","name","heading","map","onClick","active","onTriggerPause","onTriggerPlay","duration"],"sources":["src/components/core/features/presto-playlist/presto-playlist.scss?tag=presto-playlist&encapsulation=shadow","src/components/core/features/presto-playlist/presto-playlist.tsx"],"sourcesContent":[":host {\n  display: block;\n  overflow: hidden;\n}\npresto-player {\n  opacity: 0;\n  visibility: hidden;\n  transition: 0.35s opacity, 0.35s visibility;\n\n  &.ready {\n    opacity: 1;\n    visibility: visible;\n  }\n}\n","import { Component, h, Prop, State, Watch, Listen, Element } from '@stencil/core';\n\nimport { PlaylistItem } from '../../../../interfaces';\nimport { isIOS } from '../../../../util';\n\n@Component({\n  tag: 'presto-playlist',\n  styleUrl: 'presto-playlist.scss',\n  shadow: true,\n})\nexport class PrestoPlaylist {\n  @Element() el: HTMLElement;\n\n  /** Overlay component */\n  private overlay: any;\n\n  /** Array of videos from the Playlist */\n  @Prop() items: Array<PlaylistItem>;\n\n  /** Title for the Playlist */\n  @Prop() heading: string;\n\n  /** Count prefix string for the Playlist - Singular */\n  @Prop() listTextSingular: string;\n\n  /** Count prefix string for the Playlist - Plural */\n  @Prop() listTextPlural: string;\n\n  /** Transition duration for next video. */\n  @Prop() transitionDuration: number = 5;\n\n  /** Stores current video that is shown in the preview. */\n  @State() currentPlaylistItem: PlaylistItem;\n\n  /** Stores current video Plyr object that is shown in the preview. */\n  @State() currentPlyr: any;\n\n  /** Is a video playing. */\n  @State() playing: boolean = false;\n\n  /**\n   * Listening to the Rewatch Video button click event.\n   */\n  @Listen('rewatch')\n  rewatch() {\n    this.handlePlay();\n  }\n\n  /**\n   * Listening to the Next Video button click event.\n   */\n  @Listen('next')\n  next() {\n    this.handleNext();\n  }\n\n  /**\n   * Plays the video, adds overlay and Presto Video styles as soon as a new object is assigned.\n   * @param value Current value\n   * @param previousValue Previous value\n   */\n  @Watch('currentPlyr')\n  handleCurrentPlay(value, previousValue) {\n    if (!value) return;\n\n    // add the overlay.\n    this.addOverlay();\n\n    // add styles from the current video config.\n    this.currentPlyr.elements.container.getRootNode().host.style = this.currentPlaylistItem.config.styles;\n\n    // iOS has strict autoplay policies for youtube iframe embeds, so we rely on user interaction for playback.\n    if (this.currentPlyr.provider === 'youtube' && isIOS()) {\n      return;\n    }\n\n    // if we have a previous value, then we need to autoplay the video since we are switching.\n    if (previousValue !== undefined) {\n      // Restore audio (YouTube starts playing on seek if the video hasn't been played yet)\n      if (this.currentPlyr.provider === 'youtube' && !this.currentPlyr.muted && this.currentPlyr?.embed) {\n        this.currentPlyr.embed.unMute();\n      }\n\n      this.currentPlyr.play();\n    }\n  }\n\n  /**\n   * Resets the playing state whenever the current playlist item changes.\n   * This ensures the playing state starts fresh with each new video selection.\n   */\n  @Watch('currentPlaylistItem')\n  resetPlayingStateOnItemChange() {\n    this.playing = false;\n  }\n\n  /**\n   * Adds overlay to the player which will regulate the Next video button.\n   */\n  addOverlay() {\n    // create overlay\n    this.overlay = document.createElement('presto-playlist-overlay');\n    // assign properties.\n    this.overlay.nextItemTitle = this.getNextItemTitle();\n    this.overlay.isLastItem = this.isLastItem();\n    this.overlay.nextItemString = this?.listTextSingular || 'Video';\n    this.overlay.transitionDuration = this.transitionDuration;\n    // append\n    this.currentPlyr.elements?.container?.closest('.presto-player__wrapper').append(this.overlay);\n  }\n\n  /**\n   * Lifecycle: Component will load.\n   */\n  componentWillLoad() {\n    // Select the first video as a current video to be shown in the playlist.\n    this.currentPlaylistItem = this?.items?.[0] || null;\n  }\n\n  /**\n   * Handles the click on the playlist item.\n   * @param item PlaylistItem\n   */\n  handleItemClick(item: PlaylistItem) {\n    if (this.overlay) {\n      this.overlay.show = false;\n    }\n    this.el.style.height = this.el.offsetHeight + 'px';\n    this.el.style.width = this.el.offsetWidth + 'px';\n    this.currentPlaylistItem = item;\n  }\n\n  /**\n   * Assign the next item in the playlist as a current item.\n   */\n  handleNext() {\n    this.overlay.show = false;\n    this.currentPlaylistItem = this.getNextItem() || this.currentPlaylistItem;\n  }\n\n  /**\n   * Play the current video.\n   */\n  handlePlay() {\n    if (this.overlay) {\n      this.overlay.show = false;\n    }\n    this.currentPlyr.play();\n  }\n\n  /**\n   * Pause the current video.\n   */\n  handlePause() {\n    this.overlay.show = false;\n    this.currentPlyr.pause();\n  }\n\n  /**\n   * Get the next item in the playlist.\n   * @returns PlaylistItem Next item in the playlist.\n   */\n  getNextItem() {\n    if (this.isLastItem()) return this.items[0];\n\n    let nextItem: PlaylistItem;\n    for (let i = 0; i < this.items?.length; i++) {\n      if (this.items[i]?.id === this.currentPlaylistItem?.id && this.items?.length !== i + 1) {\n        nextItem = this.items[i + 1];\n        break;\n      }\n    }\n    return nextItem;\n  }\n\n  /**\n   * Checks if the current item is the last item in the playlist.\n   * @returns boolean True if the current item is the last item in the playlist.\n   */\n  isLastItem() {\n    const lastIndex = this.items?.length - 1;\n    return this.items[lastIndex]?.id === this.currentPlaylistItem?.id;\n  }\n\n  /**\n   * Get the title of the next item in the playlist.\n   * @returns string Title of the next item in the playlist.\n   */\n  getNextItemTitle() {\n    const nextItem = this.getNextItem();\n    if (undefined !== nextItem) {\n      return nextItem?.title || nextItem?.config?.title;\n    }\n    return '';\n  }\n\n  /**\n   * Rendering the component.\n   * @returns Web Component\n   */\n  render() {\n    if (!this.items?.length) return '';\n\n    const listTextS = this.listTextSingular ? this.listTextSingular : 'Video';\n    const listTextP = this.listTextPlural ? this.listTextPlural : 'Videos';\n\n    return (\n      <presto-playlist-ui>\n        {!!this.currentPlaylistItem.config?.src ? (\n          <presto-player\n            slot=\"preview\"\n            src={this.currentPlaylistItem.config?.src}\n            {...this.currentPlaylistItem.config}\n            video_id={this.currentPlaylistItem.config?.id}\n            id={`presto-player-${this.currentPlaylistItem.config?.id}`}\n            media-title={this.currentPlaylistItem.config?.title}\n            class={this.currentPlaylistItem.config?.playerClass}\n            key={this.currentPlaylistItem.config?.id}\n            provider={this.currentPlaylistItem.config?.provider}\n            onPlayerReady={e => {\n              this.currentPlyr = e.detail;\n              this.el.style.height = null;\n              this.el.style.width = null;\n            }}\n            onPlayedMedia={() => (this.playing = true)}\n            onPausedMedia={() => (this.playing = false)}\n            onEndedMedia={() => (this.overlay.show = true)}\n          />\n        ) : (\n          <slot name=\"unauthorized\" slot=\"preview\" />\n        )}\n\n        <div slot=\"title\">{this.heading || 'Playlist'}</div>\n\n        <div slot=\"count\">\n          {this.items.length} {this.items.length > 1 ? listTextP : listTextS}\n        </div>\n\n        {this.items.map(item => {\n          return (\n            <presto-playlist-item\n              slot=\"list\"\n              onClick={() => this.handleItemClick(item)}\n              active={this.currentPlaylistItem?.id === item?.id}\n              playing={this.currentPlaylistItem?.id === item?.id && this.playing}\n              class={this.currentPlaylistItem?.id === item?.id ? 'active' : ''}\n              key={item?.id}\n              onTriggerPause={() => this.handlePause()}\n              onTriggerPlay={() => this.handlePlay()}\n            >\n              <span slot=\"item-title\">\n                <span>{item?.title || item?.config?.title}</span>\n              </span>\n              <span slot=\"item-duration\">\n                <span>{item?.duration}</span>\n              </span>\n            </presto-playlist-item>\n          );\n        })}\n      </presto-playlist-ui>\n    );\n  }\n}\n"],"mappings":"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"}